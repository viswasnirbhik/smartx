<!DOCTYPE html>
<html>
<head>
    <title>SmartX | Expenses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* [Previous CSS remains exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML remains the same until the script section] -->

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBpg4XBr-tf7Gkagdh8iBVNzJ91oWMCE38",
            authDomain: "smartx-nv.firebaseapp.com",
            projectId: "smartx-nv",
            storageBucket: "smartx-nv.appspot.com",
            messagingSenderId: "348904437504",
            appId: "1:348904437504:web:57ed3b7738bdcfee4b25e5",
            measurementId: "G-13QNMH37B1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // [Previous DOM elements and auth state code remains the same]

        // Updated add expense function
        addExpenseBtn.addEventListener('click', async () => {
            const name = expenseName.value.trim();
            const amount = parseFloat(expenseAmount.value);
            let date = expenseDate.value;
            
            if (!name || isNaN(amount) || amount <= 0) {
                showError("Please enter valid expense name and amount");
                return;
            }
            
            if (!date) {
                const today = new Date();
                date = today.toISOString().split('T')[0];
            }
            
            try {
                const user = auth.currentUser;
                const expenseData = {
                    name: name,
                    amount: amount,
                    date: date,
                    memberEmail: user.email,
                    memberId: user.uid,  // Added memberId for better querying
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    month: new Date(date).getMonth() + 1,
                    year: new Date(date).getFullYear()
                };
                
                // Debugging: Log what we're trying to save
                console.log("Attempting to save:", expenseData);
                
                await db.collection('expenses').add(expenseData);
                console.log("Expense added successfully!");
                
                // Clear form
                expenseName.value = '';
                expenseAmount.value = '';
                expenseDate.value = '';
                errorMessage.textContent = '';
                
                loadExpenses();
            } catch (error) {
                console.error("Full error:", error);
                showError("Failed to add expense: " + error.message);
                
                // Additional debug info
                const user = auth.currentUser;
                if (!user) {
                    console.error("User is not authenticated!");
                } else {
                    console.log("Current user:", user.email, user.uid);
                }
            }
        });

        // [Rest of the code remains the same]
    </script>
</body>
</html>
